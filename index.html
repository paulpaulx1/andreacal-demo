<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Andrea Callard</title>
    <style>
      * { margin: 0; padding: 0; box-sizing: border-box; }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        line-height: 1.6;
        color: #222;
        background: #fff;
      }

      .container { display: flex; min-height: 100vh; }

      /* Left Navigation */
      .nav-sidebar {
        width: 250px;
        padding: 2rem 1.5rem;
        position: fixed;
        height: 100vh;
        overflow-y: auto;
        z-index: 50;
        background: #fff;
      }
      .site-title { font-size: 1.2rem; font-weight: 600; margin-bottom: 2rem; color: #000; }
      .site-title a { color: inherit; text-decoration: none; }
      .nav-item { margin-bottom: 0.25rem; }
      .nav-link {
        display: block;
        padding: 4px 0;
        text-decoration: none;
        color: #333;
        font-size: 1.05rem;
        text-transform: lowercase;
        cursor: pointer;
        transition: color 0.2s ease;
      }
      .nav-link:hover { color: #666; }
      .nav-link.active { color: #000; font-weight: 600; }

      .submenu { margin: 0.25rem 0 0 0.75rem; }
      .submenu a { display: block; padding: 0.35rem 0; font-size: 0.98rem; color: #444; text-decoration: none; }
      .submenu a.active { color: #000; font-weight: 600; }

      /* Films accordion */
      .submenu-films { margin-left: 1rem; }
      .submenu-films .film-link { display: block; padding: .35rem 0; font-size: .98rem; color: #444; text-decoration: none; }
      .submenu-films .film-link.active { color: #000; font-weight: 600; }
      .nav-toggle { background: none; border: 0; padding: .6rem 0; color: #333; font: inherit; text-transform: lowercase; cursor: pointer; width: 100%; text-align: left; }
      .nav-toggle:hover { color: #666; }
      .nav-toggle.active { color: #000; font-weight: 600; }
      .nav-toggle .caret { float: right; transition: transform .2s ease; }

      /* Main Content */
      .main-content { flex: 1; margin-left: 200px; padding: 3rem 4rem; max-width: 1000px; }

      .page-title { font-size: 1.5rem; font-weight: 700; letter-spacing: 0.3px; text-transform: uppercase; margin-bottom: 1.25rem; }

      .muted { color: #777; }
      .stack > * + * { margin-top: 1rem; }

      /* Hero / Slider */
      .hero-carousel {
        position: relative;
        width: 100%;
        max-width: 820px;
        margin: .6rem 0 1rem 0;
        overflow: hidden;
        background: #f5f5f5;
        border-radius: 4px;
        aspect-ratio: 3 / 2;
        cursor: grab;
        user-select: none;
        -webkit-user-select: none;
        -ms-user-select: none;
        touch-action: pan-y;
      }
      .hero-carousel.dragging { cursor: grabbing; }

      /* Park off-screen at 112% so scaled slides never peek.
         Animate over exactly 100% to avoid gaps. Keep fully opaque. */
      .slide {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        transform: translateX(112%) scale(1.05); /* PARK position */
        opacity: 1;
        transition: transform 0.6s ease; /* transform only */
        will-change: transform;
        border-radius: 4px;
      }
      .slide.active  { transform: translateX(0)     scale(1.05); z-index: 2; }
      .slide.leaving { transform: translateX(-112%) scale(1.05); z-index: 1; }

      /* Films list */
      .films-list { list-style: none; }
      .films-list li {
        padding: 0.5rem 0;
        border-bottom: 1px solid #eee;
        display: flex; gap: 0.5rem; align-items: baseline;
      }
      .films-list a { text-decoration: none; color: #333; }
      .films-list a:hover { text-decoration: underline; }
      .pill { font-size: 0.75rem; background: #f0f0f0; padding: 0.1rem 0.4rem; border-radius: 999px; }

      .content p { margin: 0 0 1rem 0; color: #444; }

      @media (max-width: 820px) {
        .nav-sidebar {
          width: 100%;
          position: sticky; top: 0;
          height: auto;
          border-right: none; border-bottom: 1px solid #eee;
        }
        .main-content { margin-left: 0; padding: 1.25rem 1rem; }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <nav class="nav-sidebar">
        <h1 class="site-title"><a data-route="home" href="#" id="homeLink">Andrea Callard</a></h1>

        <!-- <div class="nav-item"><a data-route="home" class="nav-link" href="#">home</a></div> -->

        <!-- FILMS as accordion -->
        <div class="nav-item">
          <button class="nav-link nav-toggle" type="button" data-toggle="films" aria-expanded="false" aria-controls="filmsSubmenu">
            films 
          </button>
          <div id="filmsSubmenu" class="submenu submenu-films" hidden></div>
        </div>

        <div class="nav-item"><a data-route="avocet" class="nav-link" href="#">Avocet Portfolio</a></div>
        <div class="nav-item"><a data-route="archive" class="nav-link" href="#">archive</a></div>
        <div class="nav-item"><a data-route="watercolors" class="nav-link" href="#">watercolors</a></div>
        <div class="nav-item"><a data-route="drawings" class="nav-link" href="#">drawings</a></div>

        <div class="nav-item">
          <a data-route="information" class="nav-link" href="#">information</a>
          <div class="submenu submenu-info">
            <a data-subroute="statement" href="#">statement</a>
            <a data-subroute="cv" href="#">CV</a>
            <a data-subroute="contact" href="#">contact</a>
          </div>
        </div>
      </nav>

      <main class="main-content">
        <div id="view"></div>
      </main>
    </div>

    <script>
      // ------------------------------
      // Homepage carousel images
      // ------------------------------
      const HOMEPAGE_IMAGES = [
        "ss3.webp","andrea_trees.webp","ss1.webp","ss2.webp","ss4.webp",
        "ss5.webp","ss7.webp","ss8.webp","ss9.webp","ss10.webp",
      ];

      // ------------------------------
      // Films data (MVP placeholder)
      // ------------------------------
      const FILMS = [
        { title: "Water Log: Immersion, Displacement, Buoyancy", slug: "water-log", year: "", images: HOMEPAGE_IMAGES.slice(0, 4), text: "" },
        { title: "Wind, Freshkills Park", slug: "wind-freshkills-park", year: "", images: HOMEPAGE_IMAGES.slice(3, 7), text: "" },
        { title: "120+ short marketing videos for Green Planet 21 (2M YouTube views)", slug: "green-planet-21", year: "", images: HOMEPAGE_IMAGES.slice(6), text: "" },
        { title: "Something Medical (10 seconds)", slug: "something-medical", year: "", images: HOMEPAGE_IMAGES.slice(1, 6), text: "" },
        { title: "Sample Map #1 (13 minutes)", slug: "sample-map-1", year: "", images: HOMEPAGE_IMAGES.slice(2, 8), text: "" },
        { title: "Talking Landscape: Early Media Work 1974–1984 (73 minutes)", slug: "talking-landscape", year: "1974–1984", images: HOMEPAGE_IMAGES.slice(0, 5), text: "" },
        { title: "Halloween Night", slug: "halloween-night", year: "", images: HOMEPAGE_IMAGES.slice(4), text: "" },
        { title: "Justice (Diallo shooting) – short documentary, Hudson Guild", slug: "justice-diallo", year: "", images: HOMEPAGE_IMAGES.slice(3), text: "" },
        { title: "Split Britches – production, set & audio design", slug: "split-britches", year: "", images: HOMEPAGE_IMAGES.slice(2), text: "" },
        { title: "Bees & Thoroughbreds – editorial consultant", slug: "bees-thoroughbreds", year: "", images: HOMEPAGE_IMAGES.slice(1), text: "" },
        { title: "Landing / San Diego – work in progress (videotape)", slug: "landing-san-diego", year: "", images: HOMEPAGE_IMAGES.slice(5), text: "" },
        { title: "Notes on Ailanthus – Super-8 (28 min)", slug: "notes-on-ailanthus", year: "", images: HOMEPAGE_IMAGES.slice(0, 6), text: "" },
        { title: "Pus Factory – animated video graphics (26 sec, b/w, silent)", slug: "pus-factory", year: "", images: HOMEPAGE_IMAGES.slice(4, 9), text: "" },
        { title: "Everglades City – editorial & production consultant", slug: "everglades-city", year: "", images: HOMEPAGE_IMAGES.slice(1, 7), text: "" },
        { title: "Writer & performer – White Columns (video)", slug: "white-columns", year: "", images: HOMEPAGE_IMAGES.slice(0, 4), text: "" },
        { title: "Freckled Rice – 16mm by Steve Ning (set design)", slug: "freckled-rice", year: "", images: HOMEPAGE_IMAGES.slice(3, 8), text: "" },
        { title: "11 thru 12 – Super-8 (12 min)", slug: "11-thru-12", year: "", images: HOMEPAGE_IMAGES.slice(6), text: "" },
        { title: "Standard Adult Wheelchair – Super-8 (12 min)", slug: "standard-adult-wheelchair", year: "", images: HOMEPAGE_IMAGES.slice(2), text: "" },
        { title: "Some Food May Be Found in the Desert – Super-8 (8 min)", slug: "some-food-desert", year: "", images: HOMEPAGE_IMAGES.slice(4), text: "" },
        { title: "Continental Drift – 16mm by Paula Longendyke (set design)", slug: "continental-drift", year: "", images: HOMEPAGE_IMAGES.slice(1, 8), text: "" },
        { title: "Fluorescent / Azalea – Super-8 (3 min)", slug: "fluorescent-azalea", year: "", images: HOMEPAGE_IMAGES.slice(0, 5), text: "" },
        { title: "Flora Funera (for Battery Park City) – Super-8 (3 min)", slug: "flora-funera", year: "", images: HOMEPAGE_IMAGES.slice(3, 9), text: "" },
        { title: "Lost Shoes Blues – Super-8 (3 min)", slug: "lost-shoes-blues", year: "", images: HOMEPAGE_IMAGES.slice(5), text: "" },
        { title: "Fragments of a Self-portrait – video, b/w (12 min)", slug: "fragments-of-a-self-portrait", year: "", images: HOMEPAGE_IMAGES.slice(2, 7), text: "" },
      ];

      const view = document.getElementById("view");

      // Build Films submenu (accordion)
      const filmsSubmenu = document.getElementById('filmsSubmenu');
      const filmsToggle  = document.querySelector('.nav-toggle[data-toggle="films"]');
      if (filmsSubmenu && filmsToggle) {
        FILMS.forEach(f => {
          const a = document.createElement('a');
          a.href = '#';
          a.className = 'film-link';
          a.dataset.slug = f.slug;
          a.textContent = f.title;
          a.addEventListener('click', (e) => {
            e.preventDefault();
            setActiveFilmLink(f.slug);
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            filmsToggle.classList.add('active');
            if (filmsSubmenu.hidden) filmsToggle.click();
            renderFilmDetail(f.slug);
          });
          filmsSubmenu.appendChild(a);
        });

        filmsToggle.addEventListener('click', () => {
          const expanded = filmsToggle.getAttribute('aria-expanded') === 'true';
          filmsToggle.setAttribute('aria-expanded', String(!expanded));
          filmsSubmenu.hidden = expanded;
          const caret = filmsToggle.querySelector('.caret');
          if (caret) caret.style.transform = expanded ? '' : 'rotate(90deg)';
        });
      }

      function setActiveFilmLink(slug) {
        if (!filmsSubmenu) return;
        filmsSubmenu.querySelectorAll('.film-link').forEach(a => {
          a.classList.toggle('active', a.dataset.slug === slug);
        });
      }

      // Nav links (ignore toggle button—handled above)
      document.querySelectorAll(".nav-link").forEach((link) => {
        link.addEventListener("click", (e) => {
          if (link.classList.contains('nav-toggle')) return;
          e.preventDefault();
          const route = link.getAttribute("data-route");
          document.querySelectorAll(".nav-link").forEach((l) => l.classList.remove("active"));
          link.classList.add("active");
          navigate(route);
        });
      });

      // Title link → home route (no hard reload)
document.getElementById("homeLink").addEventListener("click", (e) => {
  e.preventDefault();
  clearActiveNav();
  navigate("home");
  history.pushState({}, "", "/");
});

// small helper to clear highlights in the left nav
function clearActiveNav() {
  document.querySelectorAll(".nav-link, .submenu-info a, .submenu-films .film-link")
    .forEach(el => el.classList.remove("active"));
}

      // Information submenu links
      document.querySelectorAll(".submenu-info a").forEach((sublink) => {
        sublink.addEventListener("click", (e) => {
          e.preventDefault();
          document.querySelectorAll(".submenu-info a").forEach((a) => a.classList.remove("active"));
          sublink.classList.add("active");
          navigate("information", sublink.getAttribute("data-subroute"));
        });
      });

      function navigate(route, subroute) {
        if (route === "home") return renderHome();
        if (route === "films") return renderFilmsList();
        if (route === "avocet") return renderAvocet();
        if (route === "archive") return renderArchive();
        if (route === "watercolors") return renderComingSoon("watercolors");
        if (route === "drawings") return renderComingSoon("drawings");
        if (route === "information") return renderInformation(subroute || "statement");
        return renderHome();
      }

      // ------------------------------
      // Views
      // ------------------------------
      function renderHome() {
        view.innerHTML = `
          <div class="stack">
            <div class="hero-carousel" id="homeCarousel"></div>
          </div>
        `;
        // autoslide every 4s on the homepage
        initSlider("homeCarousel", HOMEPAGE_IMAGES, 4000, { draggable: true });
      }

      function renderFilmsList() {
        view.innerHTML = `
          <h2 class="page-title">Films</h2>
          <ul class="films-list" id="filmsList"></ul>
        `;
        const ul = document.getElementById("filmsList");
        FILMS.forEach((f) => {
          const li = document.createElement("li");
          const a = document.createElement("a");
          a.href = "#";
          a.textContent = f.title;
          a.addEventListener("click", (e) => {
            e.preventDefault();
            setActiveFilmLink(f.slug);
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            if (filmsToggle) filmsToggle.classList.add('active');
            if (filmsSubmenu && filmsSubmenu.hidden) filmsToggle.click();
            renderFilmDetail(f.slug);
          });
          const meta = document.createElement("span");
          meta.className = "pill muted";
          meta.textContent = f.year || "";
          li.appendChild(a);
          if (meta.textContent) li.appendChild(meta);
          ul.appendChild(li);
        });
      }

      function renderFilmDetail(slug) {
        const film = FILMS.find((f) => f.slug === slug) || FILMS[0];
        view.innerHTML = `
          <div class="stack">
            <h2 class="page-title">${film.title}</h2>
            <div class="hero-carousel" id="filmCarousel"></div>
            <div class="content">
              ${film.text || '<p class="muted">(Description forthcoming.)</p>'}
              ${film.year ? `<p class="muted">${film.year}</p>` : ""}
              <p><a href="#" id="backToFilms">← back to films</a></p>
            </div>
          </div>
        `;
        document.getElementById("backToFilms").addEventListener("click", (e) => {
          e.preventDefault();
          renderFilmsList();
        });
        initSlider("filmCarousel",
          film.images && film.images.length ? film.images : HOMEPAGE_IMAGES,
          3500,
          { draggable: true }
        );
      }

      function renderAvocet() {
        view.innerHTML = `
          <h2 class="page-title">Avocet Portfolio</h2>
          <p class="muted">Import existing content from the current website. Consider grouping by orientation:</p>
          <ul class="films-list">
            <li><span class="pill">Vertical</span> — editions listed first</li>
            <li><span class="pill">Horizontal</span> — editions listed after</li>
          </ul>
          <p class="muted">Reference: andreacallard.com/avocet-portfolio-archive/</p>
        `;
      }

      function renderArchive() {
        view.innerHTML = `
          <h2 class="page-title">Archive</h2>
          <p class="muted">Space for texts, photos, and links from earlier decades. Group by decade (1970s → 2020s).</p>
        `;
      }

      function renderComingSoon(name) {
        view.innerHTML = `
          <h2 class="page-title">${name}</h2>
          <p class="muted">Chronological order (not yet prepared).</p>
        `;
      }

      function renderInformation(subroute) {
        const map = {
          statement: "<p>Artist statement forthcoming.</p>",
          cv: "<p>CV forthcoming.</p>",
          contact: "<p>Contact: andreacallardATgmail • 212 925-8974</p>",
        };
        view.innerHTML = `
          <h2 class="page-title">Information — ${subroute}</h2>
          <div class="content">${map[subroute] || map.statement}</div>
        `;
        document.querySelectorAll(".submenu-info a").forEach((a) =>
          a.classList.toggle("active", a.getAttribute("data-subroute") === subroute)
        );
      }

      // ------------------------------
      // Slider (park at 112%, animate over 100%)
      // ------------------------------
      function initSlider(containerId, imageFiles, intervalMs = 0, opts = {}) {
        const el = document.getElementById(containerId);
        el.innerHTML = "";
        if (!imageFiles || !imageFiles.length) return;

        const slides = [];
        let idx = 0;
        let timer = null;
        const draggable = !!opts.draggable;

        const SPEED_SLIDE_MS = 750;
        const SPEED_SNAP_MS  = 350;
        const PARK_OFF = 1.12; // off-screen park factor

        function startTimer() { if (intervalMs > 0 && !timer) timer = setInterval(() => goNextFrom(0), intervalMs); }
        function stopTimer()  { if (timer) { clearInterval(timer); timer = null; } }

        function resolveSrc(filename, attempt = 0) {
          const candidates = [ `public/${filename}`, `/${filename}`, `${filename}` ];
          return encodeURI(candidates[Math.min(attempt, candidates.length - 1)]);
        }

        function addSlide(src, isActive) {
          const img = document.createElement("img");
          img.className = "slide" + (isActive ? " active" : "");
          let attempt = 0;
          img.src = resolveSrc(src, attempt);
          img.onerror = () => { attempt++; if (attempt < 3) img.src = resolveSrc(src, attempt); else img.remove(); };
          img.onload = () => {
            if (!el.style.aspectRatio && img.naturalWidth && img.naturalHeight) {
              el.style.aspectRatio = `${img.naturalWidth} / ${img.naturalHeight}`;
            }
          };
          el.appendChild(img);
          slides.push(img);
        }

        imageFiles.forEach((src, i) => addSlide(src, i === 0));
        if (slides.length <= 1) return;

        // --- helpers (park at 112%) ---
        function resetToRight(frame) {
          frame.classList.remove("active");
          frame.style.transition = "none";
          frame.style.transform = `translateX(${PARK_OFF*100}%) scale(1.05)`;
          frame.offsetHeight; frame.style.transition = "";
        }
        function resetToLeft(frame) {
          frame.classList.remove("active");
          frame.style.transition = "none";
          frame.style.transform = `translateX(${-PARK_OFF*100}%) scale(1.05)`;
          frame.offsetHeight; frame.style.transition = "";
        }

        // --- animate NEXT over 100% ---
        function goNextFrom(startDelta) { // startDelta <= 0
          const w = el.clientWidth || 1;
          const current = slides[idx];
          const nextIdx = (idx + 1) % slides.length;
          const incoming = slides[nextIdx];

          current.classList.remove("active","leaving");
          incoming.classList.remove("active","leaving");

          const start = Math.max(-w, Math.min(0, startDelta || 0));
          current.style.transition = "none";
          incoming.style.transition = "none";
          current.style.transform = `translateX(${start}px) scale(1.05)`;
          incoming.style.transform = `translateX(${w + start}px) scale(1.05)`; // <-- 100%

          requestAnimationFrame(() => {
            requestAnimationFrame(() => {
              const frac = Math.max(0.15, Math.min(1, (w - Math.abs(start)) / w));
              const dur = Math.round(SPEED_SLIDE_MS * frac);
              current.style.transition = `transform ${dur}ms ease`;
              incoming.style.transition = `transform ${dur}ms ease`;
              current.style.transform = `translateX(${-w}px) scale(1.05)`;      // <-- 100%
              incoming.style.transform = `translateX(0) scale(1.05)`;
              const onEnd = (e) => {
                if (e.propertyName !== "transform") return;
                current.removeEventListener("transitionend", onEnd);
                current.style.transition = "";
                incoming.style.transition = "";
                resetToRight(current);                // park at 112%
                incoming.classList.add("active");
                idx = nextIdx;
              };
              current.addEventListener("transitionend", onEnd);
            });
          });
        }

        // --- animate PREV over 100% ---
        function goPrevFrom(startDelta) { // startDelta >= 0
          const w = el.clientWidth || 1;
          const current = slides[idx];
          const prevIdx = (idx - 1 + slides.length) % slides.length;
          const incoming = slides[prevIdx];

          current.classList.remove("active","leaving");
          incoming.classList.remove("active","leaving");

          const start = Math.max(0, Math.min(w, startDelta || 0));
          current.style.transition = "none";
          incoming.style.transition = "none";
          current.style.transform = `translateX(${start}px) scale(1.05)`;
          incoming.style.transform = `translateX(${-w + start}px) scale(1.05)`; // <-- 100%

          requestAnimationFrame(() => {
            requestAnimationFrame(() => {
              const frac = Math.max(0.15, Math.min(1, (w - Math.abs(start)) / w));
              const dur = Math.round(SPEED_SLIDE_MS * frac);
              current.style.transition = `transform ${dur}ms ease`;
              incoming.style.transition = `transform ${dur}ms ease`;
              current.style.transform = `translateX(${w}px) scale(1.05)`;       // <-- 100%
              incoming.style.transform = `translateX(0) scale(1.05)`;
              const onEnd = (e) => {
                if (e.propertyName !== "transform") return;
                current.removeEventListener("transitionend", onEnd);
                current.style.transition = "";
                incoming.style.transition = "";
                resetToRight(current);                // park at 112%
                incoming.classList.add("active");
                idx = prevIdx;
              };
              current.addEventListener("transitionend", onEnd);
            });
          });
        }

        // snapBack over 100% too
        function snapBack(fromDelta) {
          const w = el.clientWidth || 1;
          const current = slides[idx];
          const nextIdx = (idx + 1) % slides.length;
          const prevIdx = (idx - 1 + slides.length) % slides.length;
          const nextS = slides[nextIdx];
          const prevS = slides[prevIdx];

          const frac = Math.max(0.1, Math.min(1, Math.abs(fromDelta) / w));
          const dur = Math.round(SPEED_SNAP_MS * frac);

          [current, nextS, prevS].forEach((s) => {
            s.style.transition = `transform ${dur}ms ease`;
          });

          current.style.transform = `translateX(0) scale(1.05)`;
          nextS.style.transform   = `translateX(${w}px) scale(1.05)`;   // <-- 100%
          prevS.style.transform   = `translateX(${-w}px) scale(1.05)`;  // <-- 100%

          const cleanup = () => {
            [current, nextS, prevS].forEach((s) => {
              s.style.transition = "";
              s.style.transform  = "";
            });
          };
          current.addEventListener("transitionend", cleanup, { once: true });
        }

        // Dragging with Pointer Events
        if (draggable) {
          let isDown = false, startX = 0, deltaX = 0, width = 0, activePointer = null;

          const onDown = (clientX) => {
            stopTimer();
            isDown = true; deltaX = 0; startX = clientX; width = el.clientWidth || 1;
            el.classList.add("dragging");

            const n = (idx + 1) % slides.length;
            const p = (idx - 1 + slides.length) % slides.length;

            // Park far off-screen to prevent peek…
            resetToRight(slides[n]);
            resetToLeft(slides[p]);

            // …then stage at exactly ±100% so drag starts with no gap
            slides[idx].style.transition = "none";
            slides[n].style.transition = "none";
            slides[p].style.transition = "none";
            slides[n].style.transform = `translateX(${width}px) scale(1.05)`;
            slides[p].style.transform = `translateX(${-width}px) scale(1.05)`;
          };

          const onMove = (clientX) => {
            if (!isDown) return;
            deltaX = clientX - startX;
            const current = slides[idx];
            const n = (idx + 1) % slides.length; const nextS = slides[n];
            const p = (idx - 1 + slides.length) % slides.length; const prevS = slides[p];
            current.style.transform = `translateX(${deltaX}px) scale(1.05)`;
            nextS.style.transform   = `translateX(${width + deltaX}px) scale(1.05)`;   // 100%
            prevS.style.transform   = `translateX(${-width + deltaX}px) scale(1.05)`;  // 100%
          };

          const onUp = () => {
            if (!isDown) return;
            isDown = false; el.classList.remove("dragging");
            const threshold = Math.min(80, width * 0.12);
            if (deltaX < -threshold)      { goNextFrom(deltaX); }
            else if (deltaX > threshold)  { goPrevFrom(deltaX); }
            else                          { snapBack(deltaX); }
            startTimer();
          };

          el.addEventListener("pointerdown", (e) => { activePointer = e.pointerId; el.setPointerCapture(activePointer); onDown(e.clientX); e.preventDefault(); });
          el.addEventListener("pointermove", (e) => { if (activePointer === e.pointerId) onMove(e.clientX); });
          el.addEventListener("pointerup",   (e) => { if (activePointer === e.pointerId) { onUp(); el.releasePointerCapture(activePointer); activePointer = null; } });
          window.addEventListener("pointerup", () => { if (isDown) onUp(); });
          el.addEventListener("pointercancel", () => { if (isDown) onUp(); });

          // Click fallback
          el.addEventListener("click", (e) => {
            if (Math.abs(deltaX) > 5) return;
            const rightHalf = e.offsetX / (el.clientWidth || 1) > 0.5;
            rightHalf ? goNextFrom(0) : goPrevFrom(0);
          });
        }

        // Keyboard navigation
        const onKey = (e) => {
          if (e.key === "ArrowLeft")  { stopTimer(); goPrevFrom(0); startTimer(); }
          if (e.key === "ArrowRight") { stopTimer(); goNextFrom(0); startTimer(); }
        };
        document.addEventListener("keydown", onKey);

        startTimer();
      }

      // Boot → homepage
      navigate("home");
    </script>
  </body>
</html>
